<!-- PALAVRA NA TESTA - VERS√ÉO 32.1 -->
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <!-- Viewport otimizado para Mobile -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Palavra na Testa">
    <link rel="apple-touch-icon" href="assets/icon.png">
    <link rel="shortcut icon" href="assets/icon.png" type="image/png">

    <meta name="theme-color" content="#0f172a">
    <meta name="color-scheme" content="dark only">
    <title>Palavra na Testa</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Poppins:wght@400;600;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <h2 style="border:none; color:white; font-size:1.5rem; text-align:center;">CARREGANDO...</h2>
    </div>

    <!-- MODAL -->
    <div id="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="modal-title">Aten√ß√£o</div>
            <div class="modal-msg" id="modal-msg">Mensagem</div>
            <div class="modal-actions" id="modal-actions"></div>
        </div>
    </div>

    <!-- AUDIO -->
    <audio id="snd-click" src="https://assets.mixkit.co/sfx/preview/mixkit-ui-click-2432.mp3"></audio>
    <audio id="snd-spin" src="https://assets.mixkit.co/sfx/preview/mixkit-foley-tire-rolling-looped-1681.mp3"
        loop></audio>
    <audio id="snd-win" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="snd-ok" src="assets/acerto.mp3"></audio>
    <audio id="snd-pass" src="assets/pulo.mp3"></audio>
    <audio id="snd-bgm" src="assets/musica.mp3" preload="auto"></audio>



    <!-- TELA 0: HOME -->
    <div id="screen-home" class="screen active allow-portrait">
        <h1>PALAVRA NA TESTA</h1>
        <p class="app-subtitle">Desenvolvido por Marcos Castro</p>
        <button class="btn" onclick="app.start()">INICIAR JOGO</button>
        <button class="btn btn-outline" onclick="app.to('options')">OP√á√ïES / EDITOR</button>
        <div class="version-tag"
            style="position:absolute; bottom:15px; left:20px; opacity:0.5; font-family:monospace; font-size:0.9rem;">-
        </div>
    </div>

    <!-- TELA 0.5: OP√á√ïES -->
    <div id="screen-options" class="screen scrollable allow-portrait">
        <h1>OP√á√ïES</h1>
        <div class="options-container">
            <div class="section-box">
                <h2>Visual & Times</h2>
                <div style="margin-bottom: 15px;"><label style="margin-bottom:10px">Tema do Jogo</label>
                    <div class="theme-grid" id="theme-selector"></div>
                </div>

                <!-- RESTORED DROPDOWN -->
                <div class="input-group">
                    <label>Estrutura</label>
                    <select id="opt-players" onchange="app.toggleSolo(); storage.save()">
                        <option value="2">Versus (2 Times)</option>
                        <option value="1">Solo (1 Time)</option>
                    </select>
                </div>

                <div class="teams-container" style="margin-top:15px">
                    <div class="input-group"><label style="color: var(--primary);">Time A</label><input type="text"
                            id="t1" value="Time A" style="border-left: 6px solid var(--primary)"
                            onchange="storage.save()"></div>
                    <div class="input-group" id="group-t2"><label style="color: var(--secondary);">Time B</label><input
                            type="text" id="t2" value="Time B" style="border-left: 6px solid var(--secondary)"
                            onchange="storage.save()"></div>
                </div>
            </div>

            <div class="section-box">
                <h2>Regras do Jogo</h2>
                <div class="input-row">
                    <div class="input-group" style="flex:1; width: 0;"><label>Tempo (em segundos)</label><input
                            type="number" id="opt-time" value="60" onchange="storage.save()"></div>
                    <div class="input-group" style="flex:1; width: 0;"><label>Rodadas</label><input type="number"
                            id="opt-rounds" value="3" onchange="storage.save()"></div>
                </div>

                <div class="input-group" style="margin-top:15px"><label>Modo de Sorteio</label><select id="opt-mode"
                        onchange="app.toggleThresholdVisibility(); storage.save()">
                        <option value="auto">Autom√°tico (Misto)</option>
                        <option value="wheel">Sempre Roleta</option>
                        <option value="jackpot">Sempre Jackpot</option>
                    </select></div>
                <div class="input-group" id="group-threshold" style="margin-top:10px"><label>Limite para
                        Jackpot</label><input type="number" id="opt-threshold" value="12" onchange="storage.save()">
                </div>

                <!-- AUDIO OPTIONS -->
                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;"></div>
                <h2 style="border:none; margin-bottom: 5px; font-size: 1.1rem;">√Åudio</h2>
                <div class="input-row">
                    <div class="input-group"
                        style="flex:1; width:0; flex-direction:row; align-items:center; justify-content:space-between; background:rgba(0,0,0,0.2); padding:10px; border-radius:10px;">
                        <label style="margin:0; font-size:1rem;">M√∫sica</label>
                        <input type="checkbox" id="chk-bgm-opt"
                            style="width:25px; height:25px; accent-color:var(--success);" onchange="musicMgr.toggle()">
                    </div>
                    <div class="input-group"
                        style="flex:1; width:0; flex-direction:row; align-items:center; justify-content:space-between; background:rgba(0,0,0,0.2); padding:10px; border-radius:10px;">
                        <label style="margin:0; font-size:1rem;">Efeitos</label>
                        <input type="checkbox" id="chk-sfx-opt"
                            style="width:25px; height:25px; accent-color:var(--success);" onchange="aud.toggle()">
                    </div>
                </div>

                <!-- SURVIVAL OPTIONS -->
                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;"></div>
                <h2 style="border:none; margin-bottom: 5px; font-size: 1.1rem;">Modo Sobrevivente</h2>
                <div class="input-row">
                    <div class="input-group" style="flex:1; width: 0;"><label>In√≠cio (em segundos)</label><input
                            type="number" id="opt-surv-time" value="30" onchange="storage.save()"></div>
                    <div class="input-group" style="flex:1; width: 0;"><label>B√¥nus (em segundos)</label><input
                            type="number" id="opt-surv-bonus" value="5" onchange="storage.save()"></div>
                </div>
            </div>

            <div class="section-box">
                <h2>Conte√∫do</h2>
                <div class="input-group"><label>Carregar do Google Sheets</label>
                    <div class="input-row"><input type="text" id="sheet-input" placeholder="Link da planilha..."><button
                            class="btn btn-small" style="background: var(--success); width: auto;"
                            onclick="dataMgr.loadSheet()">OK</button></div><button class="btn btn-small btn-outline"
                        style="width:100%;" onclick="dataMgr.loadDefault()">Carregar Planilha Padr√£o</button>
                </div>

                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;"></div>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                    <h2 style="border:none; margin:0; font-size:1.1rem">Editor Manual</h2>
                </div>

                <div class="input-group" style="margin-bottom: 10px;">
                    <label>Selecionar Aba</label>
                    <select id="sheet-selector" style="width: 100%; margin-bottom: 10px;"
                        onchange="dataMgr.switchSheet(this.value)"></select>

                    <div style="display: flex; gap: 8px; align-items: center; justify-content: space-between;">
                        <button class="btn btn-square" style="background:var(--success); flex:1;"
                            onclick="dataMgr.addSheet()" title="Nova Aba">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                        </button>
                        <button class="btn btn-square" style="background:var(--danger); flex:1;"
                            onclick="dataMgr.removeSheet()" title="Excluir Aba">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path d="M19 13H5v-2h14v2z" />
                            </svg>
                        </button>
                        <button class="btn btn-square" style="background:var(--secondary); flex:1;"
                            onclick="dataMgr.renameSheet()" title="Renomear Aba">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                <path
                                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                            </svg>
                        </button>
                        <button class="btn btn-square" style="background:rgba(255,255,255,0.2); flex:1;"
                            onclick="dataMgr.moveSheet(-1)" title="Mover para Cima">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" />
                            </svg>
                        </button>
                        <button class="btn btn-square" style="background:rgba(255,255,255,0.2); flex:1;"
                            onclick="dataMgr.moveSheet(1)" title="Mover para Baixo">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="editor-container">
                    <div id="view-table" class="editor-view active">
                        <div id="table-rows"></div>
                        <button class="btn btn-small btn-outline" style="width:100%; margin-top:10px"
                            onclick="dataMgr.addTableRow()">+ Categoria</button>
                    </div>
                </div>

                <div style="display:flex; gap:10px; margin-top:20px; width: 100%;">
                    <button class="btn btn-small" style="flex:1; margin:0;" onclick="dataMgr.save()">üíæ Salvar</button>
                    <button class="btn btn-small btn-outline" style="flex:1; margin:0;"
                        onclick="dataMgr.reset()">Restaurar</button>
                </div>
            </div>

            <button class="btn" style="margin: 20px auto 0 auto; display: block;"
                onclick="app.to('home')">VOLTAR</button>
        </div>
    </div>

    <!-- TELA 1: TIMES -->
    <div id="screen-teams" class="screen">
        <h1>EQUIPES</h1>
        <div class="teams-container">
            <div class="input-group"><label style="color: var(--primary);" id="lbl-t1">Time A</label><input type="text"
                    id="t1-conf" placeholder="Nome do Time A" onchange="app.confirmTeams(true)"></div>
            <div class="input-group" id="group-t2-conf"><label style="color: var(--secondary);" id="lbl-t2">Time
                    B</label><input type="text" id="t2-conf" placeholder="Nome do Time B"
                    onchange="app.confirmTeams(true)"></div>
        </div>
        <button class="btn" onclick="app.prep()">JOGAR AGORA</button>
    </div>

    <div id="screen-intro" class="screen">
        <div class="round-pill">
            <h2>RODADA</h2><span id="lbl-rd">1</span>
        </div>
        <h1 id="lbl-tm" style="font-size: 8vh; margin: 2vh 0;">TIME</h1>

        <!-- MODE SELECTOR -->
        <div class="mode-selector">
            <button class="mode-btn active" id="btn-mode-normal" onclick="app.setMode('normal')">NORMAL</button>
            <button class="mode-btn" id="btn-mode-surv" onclick="app.setMode('survival')">SOBREVIVENTE</button>
        </div>

        <p style="font-size: 2.5vh; opacity: 0.8; margin-top: 2vh;">Celular na testa</p>
        <button class="btn" style="width: auto; margin-top: 2vh;" onclick="app.toWheel()">SORTEAR TEMA</button>

        <!-- CONTROLES DE ACESSIBILIDADE DISCRETOS -->
        <!-- CONTROLES DE ACESSIBILIDADE DISCRETOS -->
        <div class="tts-controls">
            <button class="btn-access" onclick="app.openAccessModal()">
                MODO DE ACESSIBILIDADE
            </button>
        </div>
    </div>

    <div id="screen-wheel" class="screen">
        <div id="wheel-container">
            <div id="pointer"></div>
            <div id="wheel-spinner"></div>
            <div class="wheel-center-cap"></div>
        </div>
        <div id="jackpot-container">
            <div class="jackpot-highlight"></div>
            <div class="jackpot-arrow"></div>
            <div class="jackpot-arrow jackpot-arrow-right"></div>
            <div id="jackpot-strip"></div>
        </div>
        <div id="msg-force">GIRE MAIS FORTE!</div>
        <div id="msg-time">GIRE POR MAIS TEMPO!</div>
    </div>

    <div id="screen-game" class="screen">
        <div class="timer-wrapper">
            <div class="timer-text" id="timer-num">60</div>
            <div class="bonus-text" id="bonus-anim">+5s</div>
        </div>
        <div id="word-disp">PALAVRA</div>
        <div class="hud-bar">
            <div class="hud-left">‚ñº ACERTOU</div>
            <div class="hud-right">‚ñ≤ PULAR</div>
        </div>
        <div id="fb-ok" class="flash" style="background: var(--success);">ACERTOU!</div>
        <div id="fb-no" class="flash" style="background: var(--danger);">PULOU!</div>
    </div>

    <!-- TELA RESULTADO -->
    <div id="screen-res" class="screen"
        style="padding-bottom: calc(5vh + env(safe-area-inset-bottom) + 40px); justify-content: center;">
        <h1 style="font-size: clamp(2rem, 5vh, 4rem); margin: 0; line-height: 1;">FIM DA RODADA</h1>
        <div id="res-score"
            style="font-size: clamp(3rem, 6vh, 6rem); font-weight: 900; margin: 1vh 0 2vh 0; color: white; line-height: 1;">
            0 PONTOS</div>

        <div id="res-list"
            style="width:100%; max-width:600px; flex: 1; max-height: 30vh; min-height: 100px; overflow-y:auto; background:rgba(255,255,255,0.1); border-radius:15px; padding:10px; margin-bottom: 2vh;">
        </div>

        <div style="display: flex; gap: 10px; width: 100%; max-width: 400px; justify-content: center; flex-shrink: 0;">
            <button class="btn" style="flex: 2; margin:0;" onclick="app.next()">PR√ìXIMO</button>
            <button class="btn btn-outline" style="flex: 1; font-size: 1rem; padding: 0; margin:0;"
                onclick="game.openEdit()">EDITAR</button>
        </div>
    </div>

    <div id="screen-final" class="screen">
        <h1 style="font-size: 8vh;" id="final-title">FIM DE JOGO</h1>

        <!-- SCORE CONTAINER -->
        <div id="final-scores-container"
            style="display:flex; gap:4vw; margin: 4vh 0; flex-wrap: wrap; justify-content: center;">
            <div
                style="text-align:center; background:rgba(255,255,255,0.1); padding:3vh; border-radius:20px; min-width:20vw">
                <div id="fn-1" style="color:var(--primary); font-weight:bold; font-size: 3vh">Time A</div>
                <div id="fs-1" style="font-size:8vh; font-weight:900">0</div>
            </div>
            <div id="score-box-2"
                style="text-align:center; background:rgba(255,255,255,0.1); padding:3vh; border-radius:20px; min-width:20vw">
                <div id="fn-2" style="color:var(--secondary); font-weight:bold; font-size: 3vh">Time B</div>
                <div id="fs-2" style="font-size:8vh; font-weight:900">0</div>
            </div>
        </div>

        <h2 id="winner" style="color:var(--accent); font-size: 4vh;">VENCEDOR</h2>

        <!-- BOT√ïES NA MESMA LINHA: MENU + BAIXAR -->
        <div style="display: flex; gap: 10px; width: 90%; max-width: 600px; justify-content: center; margin-top: 3vh;">
            <button class="btn" style="flex: 1; margin: 0;" onclick="app.to('home')">MENU PRINCIPAL</button>
            <button class="btn btn-outline" style="flex: 1; margin: 0; font-size: 0.9rem; padding: 0;"
                onclick="dataMgr.exportExcel()">BAIXAR RESULTADOS</button>
        </div>
    </div>

    <!-- BUTTON HOME FIXED Z-INDEX -->
    <div id="home-btn"
        style="position:fixed; top:20px; left:20px; z-index:9999; cursor:pointer; opacity:0.5; display: none;"
        onclick="app.tryHome()">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
        </svg>
    </div>

    <div id="lock">
        <div class="lock-content">
            <svg class="rotate-phone-icon" viewBox="0 0 24 24">
                <path
                    d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z" />
            </svg>
            <h2 style="margin-top:20px; border:none; color: white;">GIRE A TELA</h2>
        </div>
    </div>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="script.js?v=32.3"></script>
</body>

</html>